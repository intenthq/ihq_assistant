{
  "title": "Updates bot to work better",
  "description": null,
  "author": "javierpedreira",
  "created_at": "2025-03-04T14:29:08Z",
  "changed_files": [
    {
      "filename": "slack_faiss_bot.py",
      "patch": "@@ -8,6 +8,8 @@\n import logging\n from langchain_community.docstore.in_memory import InMemoryDocstore\n from langchain_community.vectorstores import FAISS\n+from langchain import hub\n+from langchain.chat_models import init_chat_model\n from langchain.embeddings import OpenAIEmbeddings\n from faiss import IndexFlatL2\n \n@@ -47,8 +49,20 @@ def get_embedding(text):\n def search_faiss(query):\n     embeddings = OpenAIEmbeddings()\n     faiss = FAISS(embedding_function=embeddings, index=IndexFlatL2, docstore=InMemoryDocstore(), index_to_docstore_id={})    \n-    db = faiss.load_local(folder_path=\"./db/coda_linear_embeddings.db\", embeddings=embeddings, allow_dangerous_deserialization=True)\n-    return db.similarity_search(query, k=5)\n+    db = faiss.load_local(folder_path=\"./db/coda_linear_github_embeddings.db\", embeddings=embeddings, allow_dangerous_deserialization=True)\n+    \n+    docs = db.similarity_search(query, k=3)\n+    logging.debug(f\"Len docs: {len(docs)}\")\n+      \n+    docs_content = \"\\n\\n\".join(doc.page_content for doc in docs)\n+    logging.debug(f\"Doc sources: {';'.join([d.metadata['source'] for d in docs])}\")\n+    prompt = hub.pull(\"rlm/rag-prompt\")\n+\n+\n+    llm = init_chat_model(\"gpt-4\", model_provider=\"openai\")\n+    response = llm.invoke(prompt.invoke({\"question\": query, \"context\": docs_content}))\n+    \n+    return response.content\n \n # Slack bot listens for messages that mention it\n @app.event(\"app_mention\")"
    }
  ],
  "reviews": [],
  "linked_issues": "No linked issues",
  "readme": "# Install dependencies\n\nRun\n\n```\npip3 install -r ./requirements.txt\n```\n\n# Start the bot\n\nCopy `.env.template` to `.env`, fill the tokens with real tokens\n\nCreate venv\n\n```\npython3 -m venv venv\nsource venv/bin/activate\n```\n\nRun\n\n```\npython3 slack_faiss_bot.py\n```\n"
}